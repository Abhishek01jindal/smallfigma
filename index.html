<!DOCTYPE html>
<html>
<head>
  <title>Simple Figma Tool</title>

  <style>
    body {
      margin: 0;
      font-family: Arial;
      display: flex;
      height: 100vh;
    }

    #tools {
      width: 150px;
      background: #222;
      padding: 10px;
    }

    #tools button {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      color: white;
      background: blue;
      border: none;
      cursor: pointer;
    }

    #canvas {
      flex: 1;
      background: #f0f0f0;
      position: relative;
    }

    #panel {
      width: 220px;
      background: #eee;
      padding: 10px;
    }

    .item {
      position: absolute;
      cursor: move;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .selected {
      border: 2px solid blue;
    }

    .resize {
      width: 10px;
      height: 10px;
      background: blue;
      position: absolute;
      right: -5px;
      bottom: -5px;
      cursor: nwse-resize;
    }
  </style>
</head>

<body>

<div id="tools">
  <button onclick="addRect()">Add Rectangle</button>
  <button onclick="addText()">Add Text</button>
</div>

<div id="canvas"></div>

<div id="panel">
  <h3>Properties</h3>

  Width <input id="w" type="number"><br><br>
  Height <input id="h" type="number"><br><br>
  Color <input id="c" type="color"><br><br>
  Text <input id="t" type="text"><br><br>

  <button onclick="deleteSelected()" style="background:red;color:white;width:100%">
    Delete Selected
  </button>
</div>

<script>
let canvas = document.getElementById("canvas");
let selected = null;
let isLoading = false; 

function create(type, data = {}) {
  let el = document.createElement("div");
  el.className = "item";
  el.dataset.type = type;

  el.style.left = data.left || "60px";
  el.style.top = data.top || "60px";
  el.style.width = data.width || "120px";
  el.style.height = data.height || "80px";
  el.style.background = data.bg || (type === "rect" ? "orange" : "transparent");

  if (type === "text") {
    el.textContent = data.text || "Text";
    el.style.border = "1px dashed black";
    el.style.fontSize = data.fontSize || "16px"; 
  }

  el.addEventListener("mousedown", select);
  drag(el);
  canvas.appendChild(el);
}

function addRect() { create("rect"); save(); }
function addText() { create("text"); save(); }

function select(e) {
  e.stopPropagation();
  if (selected) removeResize(selected);

  selected = e.target;
  selected.classList.add("selected");
  addResize(selected);
  updatePanel();
}

canvas.addEventListener("mousedown", () => {
  if (selected) {
    removeResize(selected);
    selected.classList.remove("selected");
    selected = null;
  }
});

function drag(el) {
  el.addEventListener("mousedown", function (e) {
    if (e.target.classList.contains("resize")) return;

    let sx = e.clientX, sy = e.clientY;
    let l = el.offsetLeft, t = el.offsetTop;

    function move(e) {
      el.style.left = l + (e.clientX - sx) + "px";
      el.style.top = t + (e.clientY - sy) + "px";
      save();
    }

    function stop() {
      document.removeEventListener("mousemove", move);
      document.removeEventListener("mouseup", stop);
    }

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", stop);
  });
}

function addResize(el) {
  let r = document.createElement("div");
  r.className = "resize";
  el.appendChild(r);

  r.addEventListener("mousedown", function (e) {
    e.stopPropagation();

    let sw = el.offsetWidth;
    let sh = el.offsetHeight;
    let sx = e.clientX;
    let sy = e.clientY;

    function resize(e) {
      el.style.width = sw + (e.clientX - sx) + "px";
      el.style.height = sh + (e.clientY - sy) + "px";

      if (el.dataset.type === "text") {
        el.style.fontSize = Math.max(12, el.offsetHeight / 2.5) + "px";
      }

      updatePanel();
      save();
    }

    function stop() {
      document.removeEventListener("mousemove", resize);
      document.removeEventListener("mouseup", stop);
    }

    document.addEventListener("mousemove", resize);
    document.addEventListener("mouseup", stop);
  });
}

function removeResize(el) {
  let r = el.querySelector(".resize");
  if (r) r.remove();
}

let w = document.getElementById("w");
let h = document.getElementById("h");
let c = document.getElementById("c");
let t = document.getElementById("t");

function updatePanel() {
  if (!selected) return;
  w.value = selected.offsetWidth;
  h.value = selected.offsetHeight;
  c.value = rgbToHex(selected.style.backgroundColor);
  t.value = selected.dataset.type === "text" ? selected.textContent : "";
}

w.oninput = () => {
  if (!selected) return;
  selected.style.width = w.value + "px";
  save();
};

h.oninput = () => {
  if (!selected) return;
  selected.style.height = h.value + "px";
  save();
};

c.oninput = () => selected && (selected.style.background = c.value, save());
t.oninput = () => selected && (selected.textContent = t.value, save());

function deleteSelected() {
  if (!selected) return;
  selected.remove();
  selected = null;
  save();
}

function save() {
  let data = [];
  document.querySelectorAll(".item").forEach(el => {
    data.push({
      type: el.dataset.type,
      left: el.style.left,
      top: el.style.top,
      width: el.style.width,
      height: el.style.height,
      bg: el.style.background,
      text: el.textContent,
      fontSize: el.style.fontSize 
    });
  });
  localStorage.setItem("design", JSON.stringify(data));
}

function load() {
  isLoading = true;   
  let data = JSON.parse(localStorage.getItem("design") || "[]");
  data.forEach(d => create(d.type, d));
  isLoading = false;
}
load();

function rgbToHex(rgb) {
  if (!rgb) return "#000000";
  let n = rgb.match(/\d+/g);
  return "#" + n.map(x => (+x).toString(16).padStart(2,"0")).join("");
}
</script>

</body>
</html>
